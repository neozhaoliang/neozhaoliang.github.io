<!DOCTYPE HTML>
<html>

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SHQJ7GP8MM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-SHQJ7GP8MM');
    </script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

        <title>
            二维随机游动 （二）：一个随机的完美迷宫分别有多少死角、直路、拐角、岔路和十字路口？ | 朝花夕拾</title>
    <meta name="author" content="Zhao Liang">
    
    <meta name="description" content="和之前一样，我们还是通过一个有趣的问题来引入主题。

问题： 在 \(n\times
n\) 的正方形网格图 \(G_n\)
的所有生成树中等概率地随机任选一个，记这个随机生成树为 \(T\)，\(T\)
叫做 \(G_n\) 的一个均匀生成树。对 \(G_n\) 中任一顶点 \(v\)，\(v\)
是 \(T\) 的叶节点的概率是多少？

这个问题可以换一种更通俗的描述：

问题： 对一个完全随机的 \(n\times n\)
的完美迷宫，它包含的“死角”的比例是多少？

为什么这两个问题是一回事？
一个迷宫称作是完美的，如果迷宫中的任何两个房间之间都有且仅有唯一的道路相连，这正是生成树的等价描述！迷宫中的一个房间称作是“死角”，当且仅当它只有一条道路与其它房间相通，没有其它出路，这正是叶节点的等价描述！
下图显示了三个不同的均匀生成树，它们分别来自大小为 \(80\times 80\)，\(120\times120\) 和 \(200\times200\)
的三个网格图，这三个生成树的叶节点（用蓝色标出）占全体顶点的比例分别为
\(1884/6400=0.294375\)，\(4234/14400\approx0.294028\)，\(11776/40000=0.2944\)。咦？看起来好像是在围着一个固定的值波动喔？">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="二维随机游动 （二）：一个随机的完美迷宫分别有多少死角、直路、拐角、岔路和十字路口？"/>
    <meta property="og:site_name" content="朝花夕拾"/>

    
    <meta property="og:image" content=""/>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="朝花夕拾" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/desert.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

    <body>
        <img src="/favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

        <nav class="indigo">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">朝花夕拾</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            分类
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            关于
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            搜索
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav indigo darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="/favicon.png" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">Zhao Liang</p>
                        <p class="desc">math &amp;&amp; programming</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    首页
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    归档
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    分类
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    关于
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    搜索
                </a>
            </li>
        
    </ul>

    <ul class="side-nav indigo darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Shadertoy/">
                    Shadertoy <span class="right">3 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/代数/">
                    代数 <span class="right">2 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Durrett-概率论批判/">
                    Durrett-概率论批判 <span class="right">2 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/pywonderland-项目/">
                    pywonderland-项目 <span class="right">6 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/可视化复分析/">
                    可视化复分析 <span class="right">6 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/完美采样/">
                    完美采样 <span class="right">2 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Williams-概率和鞅/">
                    Williams-概率和鞅 <span class="right">4 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/线性代数/">
                    线性代数 <span class="right">5 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/有限群表示与结合代数/">
                    有限群表示与结合代数 <span class="right">5 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/计数组合学/">
                    计数组合学 <span class="right">5 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Coxeter-Groups/">
                    Coxeter-Groups <span class="right">6 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/随机游动/">
                    随机游动 <span class="right">1 篇</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">搜索</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


            <main>
                <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper indigo">
        <span class="breadcrumb">当前位置（分类目录）</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/随机游动/">随机游动</a>


        

        
    </div>
</nav>

    <article>
        <div class="card">
            <div class="card-content">
                

                            <div class="article-title">
                                
    
        <h1>二维随机游动 （二）：一个随机的完美迷宫分别有多少死角、直路、拐角、岔路和十字路口？</h1>
    


                            </div>
                            <time class="pink-link-context" datetime="2020-10-05T16:00:00.000Z"><a href="/transfer-current-theorem/">2020-10-06</a></time>

                                
    <div class="tags-row">
        
            <a href="/tags/Electric-network/" class="chip pink lighten-1">Electric network</a>
        
            <a href="/tags/Uniform-spanning-tree/" class="chip pink lighten-1">Uniform spanning tree</a>
        
            <a href="/tags/Markov-chain/" class="chip pink lighten-1">Markov chain</a>
        
            <a href="/tags/Transfer-current-matrix/" class="chip pink lighten-1">Transfer current matrix</a>
        
            <a href="/tags/Kirchhoff-law/" class="chip pink lighten-1">Kirchhoff law</a>
        
            <a href="/tags/Ohm-law/" class="chip pink lighten-1">Ohm law</a>
        
            <a href="/tags/Harmonic-function/" class="chip pink lighten-1">Harmonic function</a>
        
            <a href="/tags/Graph-reduction/" class="chip pink lighten-1">Graph reduction</a>
        
            <a href="/tags/Cycle-space/" class="chip pink lighten-1">Cycle space</a>
        
            <a href="/tags/Star-space/" class="chip pink lighten-1">Star space</a>
        
    </div>


                                    <div class="toc pink-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#%E5%9B%BE%E4%B8%8A%E7%9A%84%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0"><span class="section table-of-contents-text">1 图上的线性代数</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#%E6%A2%AF%E5%BA%A6%E5%92%8C%E6%95%A3%E5%BA%A6"><span class="section table-of-contents-text">梯度和散度</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#%E7%8E%AF%E7%A9%BA%E9%97%B4%E5%92%8C%E6%98%9F%E7%A9%BA%E9%97%B4%E7%9A%84%E8%A7%A3%E9%87%8A"><span class="section table-of-contents-text">环空间和星空间的解释</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#%E8%A1%A5%E5%85%85%E9%98%85%E8%AF%BB"><span class="section table-of-contents-text">补充阅读</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%9A%84%E6%B5%81"><span class="section table-of-contents-text">2 网络中的流</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#%E6%B5%81%E5%92%8C%E7%94%B5%E6%B5%81"><span class="section table-of-contents-text">流和电流</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#%E8%BD%AC%E7%A7%BB%E7%94%B5%E6%B5%81%E7%9F%A9%E9%98%B5"><span class="section table-of-contents-text">转移电流矩阵</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#%E6%A6%82%E7%8E%87%E8%A7%A3%E9%87%8A"><span class="section table-of-contents-text">3 概率解释</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#%E7%94%B5%E5%8E%8B%E7%9A%84%E6%A6%82%E7%8E%87%E8%A7%A3%E9%87%8A-%E7%AC%AC%E4%B8%80%E7%A7%8D"><span class="section table-of-contents-text">电压的概率解释 （第一种）</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#%E7%94%B5%E9%98%BB%E7%94%B5%E5%8E%8B-%E7%AC%AC%E4%BA%8C%E7%A7%8D%E7%94%B5%E6%B5%81%E7%9A%84%E6%A6%82%E7%8E%87%E8%A7%A3%E9%87%8A"><span class="section table-of-contents-text">电阻、电压
（第二种）、电流的概率解释</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#wilson-%E7%94%9F%E6%88%90%E6%A0%91%E7%AE%97%E6%B3%95"><span class="section table-of-contents-text">4 Wilson 生成树算法</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#%E5%9B%BE%E7%9A%84%E6%94%B6%E7%BC%A9"><span class="section table-of-contents-text">5 图的收缩</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#%E8%BD%AC%E7%A7%BB%E7%94%B5%E6%B5%81%E5%AE%9A%E7%90%86"><span class="section table-of-contents-text">6 转移电流定理</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#%E5%9B%9E%E7%AD%94%E6%9C%AC%E6%96%87%E5%BC%80%E5%A4%B4%E7%9A%84%E9%97%AE%E9%A2%98"><span class="section table-of-contents-text">7 回答本文开头的问题</span></a></li></ol>
</div>
                                        
                                            <div class="entry pink-link-context">
                                                
<p>和之前一样，我们还是通过一个有趣的问题来引入主题。</p>
<div class="unnumbered statement question-unnumbered definition">
<p><span class="statement-heading"><span class="statement-label">问题</span>：</span><span class="statement-spah"> </span>在 <span class="math inline">\(n\times
n\)</span> 的正方形网格图 <span class="math inline">\(G_n\)</span>
的所有生成树中等概率地随机任选一个，记这个随机生成树为 <span class="math inline">\(T\)</span>，<span class="math inline">\(T\)</span>
叫做 <span class="math inline">\(G_n\)</span> 的一个均匀生成树。对 <span class="math inline">\(G_n\)</span> 中任一顶点 <span class="math inline">\(v\)</span>，<span class="math inline">\(v\)</span>
是 <span class="math inline">\(T\)</span> 的叶节点的概率是多少？</p>
</div>
<p>这个问题可以换一种更通俗的描述：</p>
<div class="unnumbered statement question-unnumbered definition">
<p><span class="statement-heading"><span class="statement-label">问题</span>：</span><span class="statement-spah"> </span>对一个完全随机的 <span class="math inline">\(n\times n\)</span>
的完美迷宫，它包含的“死角”的比例是多少？</p>
</div>
<p>为什么这两个问题是一回事？</p>
<p>一个迷宫称作是完美的，如果迷宫中的任何两个房间之间都有且仅有唯一的道路相连，这正是生成树的等价描述！迷宫中的一个房间称作是“死角”，当且仅当它只有一条道路与其它房间相通，没有其它出路，这正是叶节点的等价描述！</p>
<p>下图显示了三个不同的均匀生成树，它们分别来自大小为 <span class="math inline">\(80\times 80\)</span>，<span class="math inline">\(120\times120\)</span> 和 <span class="math inline">\(200\times200\)</span>
的三个网格图，这三个生成树的叶节点（用蓝色标出）占全体顶点的比例分别为
<span class="math inline">\(1884/6400=0.294375\)</span>，<span class="math inline">\(4234/14400\approx0.294028\)</span>，<span class="math inline">\(11776/40000=0.2944\)</span>。咦？看起来好像是在围着一个固定的值波动喔？</p>
<span id="more"></span>
<table>
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">80x80, 0.294375</th>
<th style="text-align: center;">120x120, 0.294028</th>
<th style="text-align: center;">200x200, 0.2944</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="/images/electric-network/ust-leaves-1884-6400.png" width="200"></td>
<td style="text-align: center;"><img src="/images/electric-network/ust-leaves-4234-14400.png" width="200"></td>
<td style="text-align: center;"><img src="/images/electric-network/ust-leaves-11776-40000.png" width="200"></td>
</tr>
</tbody>
</table>
<p>本文的主题就是证明对 <span class="math inline">\(G_n\)</span>
的一个均匀生成树 <span class="math inline">\(T\)</span>，<span class="math inline">\(T\)</span> 包含的叶节点的比例随着 <span class="math inline">\(n\)</span> 趋于无穷收敛到常数 <span class="math inline">\(8(\pi-2)/\pi^3\approx 0.2945449\)</span> （想不到
<span class="math inline">\(\pi\)</span>
会出现在这里吧？）。可见上面三个模拟的数值与真实的极限值已经非常接近。</p>
<p>实际上对于度数是 <span class="math inline">\(2,3,4\)</span>
的顶点，它们的比例也随着 <span class="math inline">\(n\to\infty\)</span>
趋于固定的值，详细结果见下表：</p>
<table>
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">度数</th>
<th style="text-align: center;">极限概率</th>
<th style="text-align: center;">近似值</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1：死角</td>
<td style="text-align: center;"><span class="math display">\[\dfrac{8}{\pi^2}\left(1-\dfrac{2}{\pi}\right)\]</span></td>
<td style="text-align: center;">0.294</td>
</tr>
<tr class="even">
<td style="text-align: center;">2：拐角 + 直路</td>
<td style="text-align: center;"><span class="math display">\[\dfrac{4}{\pi}\left(2-\dfrac{9}{\pi}+\dfrac{12}{\pi^2}\right)\]</span></td>
<td style="text-align: center;">0.447</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3：岔路</td>
<td style="text-align: center;"><span class="math display">\[2\left(1-\dfrac{2}{\pi}\right)\left(1-\dfrac{6}{\pi}+\dfrac{12}{\pi^2}\right)\]</span></td>
<td style="text-align: center;">0.222</td>
</tr>
<tr class="even">
<td style="text-align: center;">4：十字路口</td>
<td style="text-align: center;"><span class="math display">\[\left(\dfrac{4}{\pi}-1\right)\left(1-\dfrac{2}{\pi}\right)^2\]</span></td>
<td style="text-align: center;">0.036</td>
</tr>
</tbody>
</table>
<p>所以在一个随机的完美迷宫中，最多的其实是“拐角” 和“直路”
(45%)，其次是“死角” (30%)，再次是“丁字岔路”
(22%)，而“十字路口”是非常少的
(3.6%)。进一步也不难算出拐角和直路的极限概率分别为 <span class="math inline">\((32-20\pi+4\pi^2)/\pi^3\approx 0.279\)</span> 和
<span class="math inline">\((16-16\pi+4\pi^2)/\pi^3\approx
0.168\)</span>。</p>
<p>这些概率是怎样计算出来的呢？它和我们这个系列的主题二维随机游动又有何关系呢？这里面的故事相当精彩。粗略地说，上面这些关于随机生成树的概率量，都可以翻译为图上随机游动的概率量，把整个图看做一个电网络，它们又可以翻译为这个电网络的物理量，而这些物理量是可以用各种方法（主要是线性代数）来算的。上面提到的这些概率值都可以从一个矩阵出发通过求其主子式得到
（或者稍微加点变化），这个矩阵叫做<strong>转移电流矩阵</strong>
(transfer current matrix)，其定义为：对给定的图 <span class="math inline">\(G\)</span>，将 <span class="math inline">\(G\)</span> 看作一个电网络，每条边的电阻都是单位
1。在其中一条边 <span class="math inline">\(e\)</span>
的两端加上电极，使得流入整个网络的电流总量为 1 个单位，记此时流过边
<span class="math inline">\(e'\)</span> 的电流总量为 <span class="math inline">\(Y(e,e')\)</span>，则矩阵 <span class="math inline">\(Y=Y(e,e')_{e,e'\in E}\)</span> 叫做网络
<span class="math inline">\(G\)</span> 的转移电流矩阵。</p>
<p>对 <span class="math inline">\(G\)</span> 的任何 <span class="math inline">\(k\)</span> 条边 <span class="math inline">\(e_1,\ldots,e_k\)</span>，定义 <span class="math inline">\(k\times k\)</span> 矩阵 <span class="math inline">\(Y^{(k)}\)</span> 为 <span class="math inline">\(Y^{(k)}(i,j)=Y(e_i,e_j)\)</span>，则我们有如下结论
（转移电流矩阵定理）：设 <span class="math inline">\(T\)</span>
是一个随机生成树，则边 <span class="math inline">\(e_1,\ldots,e_k\)</span> 都属于 <span class="math inline">\(T\)</span> 的概率 <span class="math display">\[\mathbb{P}(e_1,\ldots,e_k \in T)=\det
Y^{(k)}.\]</span> 举个例子，<span class="math inline">\(\mathbb{Z}^2\)</span> 中与原点 <span class="math inline">\((0, 0)\)</span> 相邻的四条边为 <span class="math inline">\(e_1=(1,0)\)</span>，<span class="math inline">\(e_2=(0, 1)\)</span>，<span class="math inline">\(e_3=(-1,0)\)</span>，<span class="math inline">\(e_4=(0,
-1)\)</span>，我们后面会计算出这四条边对应的转移电流矩阵为</p>
<p><span class="math display">\[
Y^{(4)}=
\begin{pmatrix}
\frac{1}{2} &amp; \frac{1}{2}-\frac{1}{\pi} &amp;
\frac{2}{\pi}-\frac{1}{2} &amp; \frac{1}{2}-\frac{1}{\pi}\\
\frac{1}{2}-\frac{1}{\pi} &amp; \frac{1}{2} &amp;
\frac{1}{2}-\frac{1}{\pi} &amp; \frac{2}{\pi}-\frac{1}{2}\\
\frac{2}{\pi}-\frac{1}{2} &amp; \frac{1}{2}-\frac{1}{\pi} &amp;
\frac{1}{2} &amp; \frac{1}{2}-\frac{1}{\pi}\\
\frac{1}{2}-\frac{1}{\pi} &amp; \frac{2}{\pi}-\frac{1}{2} &amp;
\frac{1}{2}-\frac{1}{\pi} &amp; \frac{1}{2}
\end{pmatrix}.
\]</span></p>
<p>于是原点的度数等于 4 的概率是 <span class="math display">\[\mathbb{P}(e_1,e_2,e_3,e_4\in\mathbb{T})=\det
Y^{(4)}=\left(\frac{4}{\pi}-1\right)\left(1-\frac{2}{\pi}\right)^2\approx
0.0361.\]</span> 这正是上面列出的十字路口的概率！</p>
<p>如果是计算概率 <span class="math inline">\(\mathbb{P}(e_1,e_2,e_3\notin T, e_4\in T)\)</span>
呢？方法如下，把要排除掉的 <span class="math inline">\(e_1,e_2,e_3\)</span> 对应的 <span class="math inline">\(Y^{(4)}\)</span>
的前三行全部取负值，并且给前三个对角元加上 1，保持第 4 行不变，得到</p>
<p><span class="math display">\[
Y^{(4)}_{\overline{123}4}=\begin{pmatrix}
\frac{1}{2} &amp; \frac{1}{\pi}-\frac{1}{2} &amp;
-\frac{2}{\pi}+\frac{1}{2} &amp; \frac{1}{\pi}-\frac{1}{2}\\
\frac{1}{\pi}-\frac{1}{2} &amp; \frac{1}{2} &amp;
\frac{1}{\pi}-\frac{1}{2} &amp; -\frac{2}{\pi}+\frac{1}{2}\\
-\frac{2}{\pi}+\frac{1}{2} &amp; \frac{1}{\pi}-\frac{1}{2} &amp;
\frac{1}{2} &amp; \frac{1}{\pi}-\frac{1}{2}\\
\frac{1}{2}-\frac{1}{\pi} &amp; \frac{2}{\pi}-\frac{1}{2} &amp;
\frac{1}{2}-\frac{1}{\pi} &amp; \frac{1}{2}\end{pmatrix}.
\]</span></p>
<p>则 <span class="math display">\[\mathbb{P}(e_1,e_2,e_3\notin T,
e_4\in T)=\det
Y^{(4)}_{\overline{123}4}=\frac{2}{\pi^2}-\frac{4}{\pi^3}.\]</span>
于是原点是叶节点的概率是 <span class="math inline">\(4\times\det
Y^{(4)}_{\overline{123}4}\approx
0.2945\)</span>，这正是之前看到的死角的比例。</p>
<p>所以解决问题的关键就是求解 <span class="math inline">\(\mathbb{Z}^2\)</span>
上的转移电流矩阵，本文接下来就来介绍具体的理论。这个故事并无特别的难点，但确实比较长。我主要参考了
Lyons 等人关于图随机游动的专著 <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>，Stanley
的代数组合学教材 <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> 以及网上一些公开的讲义。</p>
<h1 id="图上的线性代数">1 图上的线性代数</h1>
<p>一个<strong>网络</strong> <span class="math inline">\(\mathcal{N}=(G,
c)\)</span> 由一个有限图 <span class="math inline">\(G=(V,E)\)</span>
和一个权值函数 <span class="math inline">\(c:E\to\mathbb{R}_{\geq0}\)</span> 组成。这里 <span class="math inline">\(G\)</span> 是连通的无向图，其每条边 <span class="math inline">\(e\in E\)</span> 有一个权值 <span class="math inline">\(c(e)\in[0, +\infty)\)</span>，叫做 <span class="math inline">\(e\)</span> 的<strong>电导</strong>，其倒数 <span class="math inline">\(r(e)=1/c(e)\)</span> 叫做 <span class="math inline">\(e\)</span> 的<strong>电阻</strong>。</p>
<p>设 <span class="math inline">\(x,\,y\in V\)</span> 是两个顶点，我们用
<span class="math inline">\(x\sim y\)</span> 表示 <span class="math inline">\(x,y\)</span>
是相邻的。由于本文主要考察边上的流函数，而流函数是有方向的，<strong>所以我们约定边集
<span class="math inline">\(E\)</span> 同时包含有序对 <span class="math inline">\((x,y)\)</span> 和 <span class="math inline">\((y,x)\)</span>，即一条边作为有序对在 <span class="math inline">\(E\)</span> 中出现两次</strong>。当 <span class="math inline">\(e=(x,y)\)</span> 时，我们记 <span class="math inline">\(-e=(y,x)\)</span> 为 <span class="math inline">\(e\)</span> 的<strong>反向边</strong>。并用记号
<span class="math inline">\(E_{1/2}\)</span> 表示对每个 <span class="math inline">\(e\)</span>，在 <span class="math inline">\(e\)</span> 和 <span class="math inline">\(-e\)</span> 中任选一个组成的集合。<span class="math inline">\(E_{1/2}\)</span> 的一个选取方式对应 <span class="math inline">\(E\)</span>
的一个定向，不过我们一般不必明确写出这个选取方式。此外当 <span class="math inline">\(e=(x,y)\)</span> 时，我们称 <span class="math inline">\(e^-=x\)</span> 为 <span class="math inline">\(e\)</span> 的<strong>尾部</strong>，<span class="math inline">\(e^+=y\)</span> 为 <span class="math inline">\(e\)</span>
的<strong>头部</strong>。为了记住这一点，你可以把 <span class="math inline">\(e\)</span> 想象成一个从 <span class="math inline">\(x\)</span> 到 <span class="math inline">\(y\)</span> 的箭头：<span class="math inline">\(x\xrightarrow{e}y\)</span>。注意在反向边 <span class="math inline">\(-e\)</span> 中 <span class="math inline">\(x\)</span> 变为头部，<span class="math inline">\(y\)</span> 变为尾部。</p>
<p>对每个 <span class="math inline">\(e\in E\)</span>，当 <span class="math inline">\(e=(x,y)\)</span> 时我们也记 <span class="math inline">\(c(x,y)=c(e)\)</span>。<strong>我们要求电导函数
<span class="math inline">\(c(x,y)\)</span> 关于 <span class="math inline">\(x,y\)</span> 是对称的：<span class="math inline">\(c(x,y)=c(y,x)\)</span></strong>。所以当写 <span class="math inline">\(c(e)\)</span> 的时候我们不用关心 <span class="math inline">\(e\)</span> 的定向。对每个顶点 <span class="math inline">\(x\in V\)</span>，记 <span class="math inline">\(c(x)=\sum_{y\sim x}c(x,y)\)</span>。</p>
<p>所有 <span class="math inline">\(V\)</span> 上的实值函数 <span class="math inline">\(f:V\to\mathbb{R}\)</span> 构成一个内积空间 <span class="math inline">\(\ell^2(V)\)</span>： <span class="math display">\[(f,\, g)_V = \sum_{x\in
V}c(x)f(x)g(x).\]</span></p>
<p>所有 <span class="math inline">\(E\)</span>
上的<strong>反对称</strong>实值函数 <span class="math inline">\(\theta:
E\to\mathbb{R}\)</span> 也构成一个内积空间 <span class="math inline">\(\ell^2_{-}(E)\)</span>： <span class="math display">\[(\theta,\,\theta')_E = \frac{1}{2}\sum_{e\in
E}r(e)\theta(e)\theta'(e)=\sum_{e\in
E_{1/2}}r(e)\theta(e)\theta'(e).\]</span> 这里反对称的意思是对任何
<span class="math inline">\(e=\{x,y\}\)</span> 有 <span class="math inline">\(\theta(x,
y)=-\theta(y,x)\)</span>。注意上式右边的求和与边的定向是无关的，如果换成
<span class="math inline">\(-e\)</span> 的话乘积 <span class="math inline">\(\theta(e)\theta'(e)\)</span>
还是不变的，即内积的定义与 <span class="math inline">\(E_{1/2}\)</span>
的选取方式无关。</p>
<p>以上定义基本上与 Lyons
等人的书保持一致，但是接下来的叙述会有比较大的差别。</p>
<h2 id="梯度和散度">梯度和散度</h2>
<div class="statement definition plain">
<p><span class="statement-heading"><span class="statement-label">定义
1.1</span>.</span></p>
<ol type="1">
<li><p>定义<strong>梯度</strong>算子 <span class="math inline">\(\nabla:
\ell^2(V)\to\ell^{2}_{-}(E)\)</span> 为 <span class="math display">\[(\nabla f)(x,y) = c(x,
y)\big[f(x)-f(y)\big]=c(e)\big[f(e^-)-f(e^+)\big].\]</span> 如果把 <span class="math inline">\(f\)</span>
理解为每个顶点处的电压的话，梯度算子给出的是电压之差除以电阻值，即经过边
<span class="math inline">\(e\)</span> 的有向电流。</p></li>
<li><p>定义<strong>散度</strong>算子 <span class="math inline">\(\mathrm{div}:\ell^{2}_{-}(E)\to\ell^2(V)\)</span>
为 <span class="math display">\[(\mathrm{div}\,\theta)(x) =
\frac{1}{c(x)}\sum_{y\sim x}\theta(x,
y)=\frac{1}{c(x)}\sum_{e^-=x}\theta(e).\]</span>
上式右边可能有的求和项大于 0，有的小于 0。如果把 <span class="math inline">\(\theta\)</span>
理解为每条边上的有向电流的话，散度算子给出的是每个顶点处的净流出量。</p></li>
<li><p>定义<strong>拉普拉斯</strong>算子 <span class="math inline">\(\Delta:\ell^2(V)\to\ell^{2}(V)\)</span> 为 <span class="math display">\[
(\Delta f)(x) = (\mathrm{div}\,\nabla f)(x) = f(x)-\sum_{y\sim
x}\frac{c(x,y)}{c(x)}f(y).
\]</span> 如果 <span class="math inline">\((\Delta f)(x)=0\)</span> 对
<span class="math inline">\(x\in V\)</span> 成立，我们就称 <span class="math inline">\(f\)</span> 在 <span class="math inline">\(x\)</span> 处是<strong>调和</strong>的。</p></li>
</ol>
</div>
<div class="statement theorem plain">
<p><span class="statement-heading"><span class="statement-label">定理
1.2</span>.</span><span class="statement-spah">
</span>梯度算子和散度算子是一对共轭算子：对任何 <span class="math inline">\(f\in\ell^2(V)\)</span> 和 <span class="math inline">\(\theta\in\ell_{-}^2(E)\)</span> 有 <span class="math display">\[(f,\,\mathrm{div}\,\theta)_V = (\nabla
f,\,\theta)_E.\]</span></p>
</div>
<p><strong>证明</strong>：上式对 <span class="math inline">\(f\)</span>
是线性的，所以我们只要对形如 <span class="math inline">\(\mathbb{1}_{\{
x \}},x\in V\)</span> 的元素验证即可。这时左边是 <span class="math inline">\(c(x)\cdot(\mathrm{div}\,\theta)(x)\)</span>，右边是
<span class="math inline">\(\sum_{y\sim
x}\theta(x,y)\)</span>，二者当然相等。<span class="math inline">\(\blacksquare\)</span></p>
<div class="statement definition plain">
<p><span class="statement-heading"><span class="statement-label">定义
1.3</span>.</span><span class="statement-spah"> </span>我们称映射 <span class="math inline">\(\mathrm{div}\)</span> 的核 <span class="math inline">\(\mathrm{Ker\,div}\)</span> 为环空间 (cycle
space)，记作 <span class="math inline">\(\lozenge\)</span>。称映射 <span class="math inline">\(\nabla\)</span> 的像 <span class="math inline">\(\mathrm{Im}\nabla\)</span> 为星空间 (star
space)，记作 <span class="math inline">\(\bigstar\)</span>。环空间和星空间都是 <span class="math inline">\(\ell_{-}^2(E)\)</span> 的子空间。</p>
</div>
<div class="statement theorem plain">
<p><span class="statement-heading"><span class="statement-label">定理
1.4</span>.</span><span class="statement-spah"> </span><span class="math inline">\(\ell_{-}^2(E)\)</span>
是环空间和星空间的正交直和：<span class="math inline">\(\ell_{-}^2(E)=\lozenge\oplus\bigstar\)</span>。</p>
</div>
<p><strong>证明</strong>：由于 <span class="math inline">\(\{\mathbb{1}_{\{ x \}},x\in V\}\)</span> 构成
<span class="math inline">\(\ell^2(V)\)</span> 的一组基，所以它们在
<span class="math inline">\(\nabla\)</span> 下的像构成 <span class="math inline">\(\bigstar\)</span> 的一组基。从定理 1.1
的证明中我们已经看到对任何 <span class="math inline">\(\theta\in\ell^2_{-}(E)\)</span> 有 <span class="math display">\[(\nabla \mathbb{1}_{\{ x
\}},\,\theta)_E=c(x)(\mathrm{div}\,\theta)(x).\]</span> 于是 <span class="math inline">\(\theta\)</span> 与任何 <span class="math inline">\(\nabla \mathbb{1}_{\{ x \}}\)</span> 正交当且仅当
<span class="math inline">\((\mathrm{div}\,\theta)(x)=0\)</span> 对任何
<span class="math inline">\(x\in V\)</span> 成立，即当且仅当 <span class="math inline">\(\theta\in\lozenge\)</span>，从而 <span class="math inline">\(\lozenge\)</span> 和 <span class="math inline">\(\bigstar\)</span> 互为正交补空间，证毕。</p>
<h2 id="环空间和星空间的解释">环空间和星空间的解释</h2>
<p>我们来解释一下为什么这两个子空间叫做“环空间”和“星空间”。</p>
<p>首先是环空间。对任一 <span class="math inline">\(e\in E\)</span>，记
<span class="math display">\[\chi^e=\mathbb{1}_{\{ e \}} -
\mathbb{1}_{\{ -e \}}\in\ell^2_{-}(E)\]</span> 为边 <span class="math inline">\(e\)</span> 的示性函数，即 <span class="math inline">\(\chi^e\)</span> 在 <span class="math inline">\(e\)</span> 和 <span class="math inline">\(-e\)</span> 上取值分别为 <span class="math inline">\(\pm1\)</span>，在其它边上都是 0。</p>
<p>显然 <span class="math inline">\(\chi^{e}=-\chi^{-e}\)</span>。</p>
<p>设 <span class="math inline">\(e_1=(v_1,v_2),
e_2=(v_2,v_3),\ldots,e_k=(v_k,v_1)\)</span> 首尾相接构成一条回路 <span class="math inline">\(C\)</span>，即 <span class="math display">\[v_1\xrightarrow{\quad e_1
\quad}v_2\xrightarrow{\quad e_2 \quad}\cdots\xrightarrow{\quad e_{k-1}
\quad}v_k\xrightarrow{\quad e_k \quad}v_1.\]</span></p>
<p><img style="margin:0px auto;display:block" src="/images/electric-network/cycle.svg" width="150"></p>
<p>定义 <span class="math inline">\(C\)</span> 对应的环函数 <span class="math inline">\(f^C = \sum_{i=1}^k\chi^{e_i}\)</span>，则从 <span class="math inline">\(v_1\)</span> 出发绕 <span class="math inline">\(C\)</span> 一圈一路上经过的所有边 <span class="math inline">\(f\)</span> 的值都是 <span class="math inline">\(+1\)</span> （沿着反方向绕都是 <span class="math inline">\(-1\)</span>），于是 <span class="math inline">\(f^C\)</span> 在 <span class="math inline">\(C\)</span> 包含的每个顶点上 1 进 1 出，在 <span class="math inline">\(C\)</span> 之外的顶点上 0 进 0 出，从而 <span class="math inline">\(f^C\in\lozenge\)</span>。反之，我们断言 <span class="math inline">\(\lozenge\)</span> 可以由所有的环函数 <span class="math inline">\(f^C\)</span> 张成，这就是为什么 <span class="math inline">\(\lozenge\)</span> 叫做环空间。</p>
<p>设 <span class="math inline">\(\theta\in\lozenge\)</span>，定义 <span class="math inline">\(\theta\)</span> 的支集为 <span class="math display">\[\mathrm{supp}(\theta)=\{e\in
E\mid\theta(e)\ne0\}.\]</span> 如果 <span class="math inline">\(\mathrm{supp}(\theta)\)</span>
非空，则它必然包含一个回路，否则 <span class="math inline">\(\mathrm{supp}(\theta)\)</span>
构成的子图中必然有一个叶顶点 （度数恰好为
1），从而这一点处的散度不可能为 0，矛盾！于是 <span class="math inline">\(\mathrm{supp}(\theta)\)</span> 包含一个回路 <span class="math inline">\(C\)</span>，我们可以选择合适的常数 <span class="math inline">\(\alpha\)</span> 使得 <span class="math inline">\(\widetilde{\theta}=\theta-\alpha f^C\)</span>
在某个 <span class="math inline">\(e\in C\)</span> 上为 0，则 <span class="math inline">\(\widetilde{\theta}\)</span> 的支集严格小于 <span class="math inline">\(\theta\)</span>。对 <span class="math inline">\(\widetilde{\theta}\)</span>
重复此操作一直下去必然可以在有限次后将支集变为空集，这就证明了 <span class="math inline">\(\theta\)</span> 可以表示为形如 <span class="math inline">\(f^C\)</span> 的线性组合。</p>
<p>星空间也有一个类似的形象描述。对每个顶点 <span class="math inline">\(x\)</span>，我们也有一个 <span class="math inline">\(\ell^2_{-}(E)\)</span> 上的函数与之对应：<span class="math inline">\(\sum_{e^-=x}c(e)\chi^e\)</span>。这个函数很直观，它的支集是从
<span class="math inline">\(x\)</span> 出发伸出去的星状结构。</p>
<p><img style="margin:0px auto;display:block" src="/images/electric-network/div.svg" width="150"></p>
<p>对任何 <span class="math inline">\(\theta\in\ell^2_{-}(E)\)</span>，我们有 <span class="math display">\[(\mathrm{div}\,\theta)(x)=\sum_{e^-=x}\theta(e)=\sum_{e^-=x}\left(c(e)\chi^e,\theta\right)_E=\left(\sum_{e^-=x}c(e)\chi^e,\theta\right)_E.\]</span>
由于 <span class="math inline">\(\theta\in\lozenge\)</span> 当且仅当
<span class="math inline">\((\mathrm{div}\,\theta)(x)=0\)</span> 对所有
<span class="math inline">\(\in V\)</span> 成立，也就是 <span class="math inline">\(\theta\)</span> 与所有 <span class="math inline">\(\sum_{e^-=x}c(e)\chi^e\)</span>
正交，所以我们证明了 <span class="math inline">\(\left\{\sum_{e^-=x}c(e)\chi^e\mid x\in
V\right\}\)</span> 可以生成 <span class="math inline">\(\bigstar\)</span>。</p>
<h2 id="补充阅读">补充阅读</h2>
<p>这一节一下出现了好几个算子，以及环空间和星空间的概念，对初次接触的人来说有点名词爆炸，所以这里补充一段阅读材料：</p>
<p>我们在高中物理所学的基尔霍夫定律（电流、电压）是基尔霍夫于 1845
年发表的，那时他只有 21 岁。两年后的 1847
年基尔霍夫发表了另一篇文章，系统阐述了怎样用求解线性方程组的方法计算电路中的电流。第二篇文章很有意思，基尔霍夫证明了在一个有
<span class="math inline">\(v\)</span> 个中间节点和 <span class="math inline">\(e\)</span>
条边的电路中，我们可以对每个中间节点列出一个方程（流入=流出），这样得到的
<span class="math inline">\(v\)</span>
个方程是线性相关的，但是删掉任何一个方程以后剩下的 <span class="math inline">\(v-1\)</span>
个方程都是线性无关的；此外我们还可以对每个“基本回路”列出一个方程（电压绕回路一圈改变为
0），得到 <span class="math inline">\(\mu\)</span> 个线性方程，其中
<span class="math inline">\(\mu\)</span>
是电路包含的“基本回路”的个数。这 <span class="math inline">\(\mu\)</span> 个方程和前面 <span class="math inline">\(v-1\)</span>
个方程合起来仍然是线性无关的，于是我们就有了 <span class="math inline">\(\mu+v-1\)</span>
个独立的方程，这些方程就足以解出所有边上的电流！</p>
<p>什么是基本回路？直观上理解很容易：下图标注了 <span class="math inline">\(\alpha,\beta,\gamma\)</span>
三个基本回路，它们不能拆解为更小回路的组合：</p>
<p><img style="margin:0px auto;display:block" src="/images/electric-network/basic_cycles.svg" width="350"></p>
<p>基本回路的准确定义是，取 <span class="math inline">\(G\)</span>
的一个生成树 <span class="math inline">\(T\)</span>，则对任何 <span class="math inline">\(e\in G\backslash T\)</span>，将 <span class="math inline">\(e\)</span> 加入 <span class="math inline">\(T\)</span> 以后都会形成某个回路 <span class="math inline">\(\chi^e\)</span>，<span class="math inline">\(\chi^e\)</span> 就是一个基本回路。</p>
<ol type="1">
<li>由于 <span class="math inline">\(T\)</span> 包含 <span class="math inline">\(v-1\)</span> 条边，所以 <span class="math inline">\(G\backslash T\)</span> 有 <span class="math inline">\(e-v+1\)</span> 条边，所以这样的回路有 <span class="math inline">\(e-v+1\)</span> 个。</li>
<li>这 <span class="math inline">\(e-v+1\)</span>
个回路是线性无关的，因为它们当中任何一个都不能表示为其它回路的线性组合。这是因为，假设基本回路
<span class="math inline">\(\chi^e\)</span> 是由 <span class="math inline">\(T\cup\{e\}\)</span>
得到的，由于其它回路的支集都不含 <span class="math inline">\(e\)</span>，所以它们的组合的支集也不会包含 <span class="math inline">\(e\)</span>。</li>
<li>于是环空间 <span class="math inline">\(\lozenge\)</span> 中包含
<span class="math inline">\(e-v+1\)</span> 个线性无关的回路，从而 <span class="math inline">\(\dim\lozenge\geq e-v+1\)</span>。</li>
<li>我们来证明 <span class="math inline">\(\dim\bigstar=v-1\)</span>，于是由 <span class="math inline">\(\dim\ell^2_{-}(E)=e\)</span> 即得 <span class="math inline">\(\dim\lozenge= e-v+1\)</span>。这是因为 <span class="math inline">\(\mathrm{Ker}\,\nabla\)</span> 显然是 1
维的：它由所有 <span class="math inline">\(V\)</span>
上的常函数构成，所以 <span class="math display">\[\dim\bigstar=\dim\ell^2(E)-\dim\mathrm{Ker}\,\nabla=v-1.\]</span></li>
</ol>
<p>总结一下：</p>
<ol type="1">
<li>环空间的维数是 <span class="math inline">\(\dim\bigstar=e-v+1\)</span>，由基本回路张成，对每一个基本回路可以利用电压定律列一个独立方程。</li>
<li>星空间的维数是 <span class="math inline">\(v-1\)</span>，由任何
<span class="math inline">\(v-1\)</span> 个中间节点张成，对这 <span class="math inline">\(v-1\)</span>
个顶点中的每一个都可以用电流定律列一个独立方程。</li>
</ol>
<p>1, 2 合起来正好可以解出全部 <span class="math inline">\(e\)</span>
条边上的电流！</p>
<h1 id="网络中的流">2 网络中的流</h1>
<h2 id="流和电流">流和电流</h2>
<p>仍然设 <span class="math inline">\(\mathcal{N}=(G,c)\)</span>
是一个网络，<span class="math inline">\(Z\)</span> 是 <span class="math inline">\(V\)</span> 的一个子集，<span class="math inline">\(a\notin Z\)</span> 是一个顶点。</p>
<div class="statement definition plain">
<p><span class="statement-heading"><span class="statement-label">定义
2.1</span>.</span><span class="statement-spah"> </span>我们称 <span class="math inline">\(\theta\in\ell_{-}^2(E)\)</span> 是一个从 <span class="math inline">\(a\)</span> 到 <span class="math inline">\(Z\)</span> 的流，如果以下两个条件成立：</p>
<ol type="1">
<li><span class="math inline">\((\mathrm{div}\,\theta)(a)\geq
0\)</span>。</li>
<li>对任何 <span class="math inline">\(x\notin \{a\}\cup Z\)</span> 有
<span class="math inline">\((\mathrm{div}\,\theta)(x)=0\)</span>。</li>
</ol>
<p><span class="math inline">\(a\)</span> 叫做 <span class="math inline">\(\theta\)</span> 的源点，<span class="math inline">\(Z\)</span> 叫做 <span class="math inline">\(\theta\)</span> 的汇点。</p>
<p>定义流 <span class="math inline">\(\theta\)</span> 的强度为从源点
<span class="math inline">\(a\)</span> 流入网络的量： <span class="math display">\[\mathrm{strength}(\theta)=\sum_{x\sim a}\theta(a,
x).\]</span> 我们也把 <span class="math inline">\(\mathrm{strength}(\theta)\)</span> 记作 <span class="math inline">\(\|\theta\|\)</span>，如果有 <span class="math inline">\(\|\theta\|=1\)</span> 成立，就称 <span class="math inline">\(\theta\)</span>
是一个<strong>单位流</strong>。</p>
<p>此外定义 <span class="math inline">\(\theta\)</span> 的能量为 <span class="math display">\[\mathcal{E}(\theta)=(\theta,\,\theta)_E.\]</span></p>
</div>
<p>此定义自动蕴含了 <span class="math inline">\(\sum_{z\in
Z}(\mathrm{div}\,\theta)(z)=-(\mathrm{div}\,\theta)(a)\leq0\)</span>：考虑
<span class="math inline">\(V\)</span> 上的常函数 <span class="math inline">\(1\)</span>，则 <span class="math inline">\(\nabla
1=0\)</span>，于是 <span class="math display">\[0=(\nabla
1,\,\theta)_E=(1,\,\mathrm{div}\,\theta)_V=(\mathrm{div}\,\theta)(a)+\sum_{z\in
Z}(\mathrm{div}\,\theta)(z).\]</span> 即对整个网络来说，从 <span class="math inline">\(a\)</span> 流出的量等于流入 <span class="math inline">\(Z\)</span> 的量，中间没有任何“淤积”。</p>
<div class="statement definition plain">
<p><span class="statement-heading"><span class="statement-label">定义
2.2</span>.</span><span class="statement-spah"> </span>设 <span class="math inline">\(\theta\)</span> 是一个从 <span class="math inline">\(a\)</span> 到 <span class="math inline">\(Z\)</span> 的流，如果还有 <span class="math inline">\(\theta=\nabla g\in\bigstar\)</span> 成立，就称
<span class="math inline">\(\theta\)</span>
是一个<strong>电流</strong>，<span class="math inline">\(g\)</span> 叫做
<span class="math inline">\(\theta\)</span> 的电势。</p>
</div>
<p>我们总结一下流和电流的特点：</p>
<ol type="1">
<li>你可以把 <span class="math inline">\(a\)</span>
理解为电源正极，<span class="math inline">\(Z\)</span>
理解为网络接地的部分。</li>
<li>流函数要求对任何 <span class="math inline">\(x\notin \{a\}\cup
Z\)</span> 有 <span class="math inline">\((\mathrm{div}\,\theta)(x)=0\)</span>
等价于物理中的基尔霍夫电流定律：任何中间节点的流量守恒。</li>
<li>电流函数要求 <span class="math inline">\(\theta=\nabla
g\in\bigstar\)</span> 等价于物理中的欧姆定律，即电流 <span class="math inline">\(\theta\)</span> 等于电势差除以电阻 <span class="math inline">\(r(e)\)</span>。</li>
</ol>
<h2 id="转移电流矩阵">转移电流矩阵</h2>
<p>在本文中，我们最关心的电流函数是将一条边 <span class="math inline">\(e=\{x,y\}\)</span> 的端点 <span class="math inline">\(x\)</span> 通入单位电流，另一端点 <span class="math inline">\(y\)</span> 接地时网络中对应的电流函数，此函数记作
<span class="math inline">\(i^e\)</span>。对任一边 <span class="math inline">\(e'\)</span>，<span class="math inline">\(i^e(e')\)</span> 就是此时流过 <span class="math inline">\(e'\)</span> 的电流量。</p>
<div class="statement proposition plain">
<p><span class="statement-heading"><span class="statement-label">命题
2.3</span>.</span><span class="statement-spah"> </span><span class="math inline">\(\chi^e\)</span> 在 <span class="math inline">\(\bigstar\)</span> 上的正交投影即为 <span class="math inline">\(i^e\)</span>。</p>
</div>
<p><strong>证明</strong>：显然 <span class="math inline">\(\chi^e\)</span> 是从 <span class="math inline">\(x\)</span> 到 <span class="math inline">\(y\)</span> 的单位流，且在任何 <span class="math inline">\(z\notin e\)</span> 处散度为 0。<span class="math inline">\(\chi^e\)</span> 在 <span class="math inline">\(\bigstar\)</span> 的投影是通过减去一个 <span class="math inline">\(\mathrm{div}\)</span> 处处为 0
的流得到的，这不改变任何顶点处的散度值，所以投影分量仍然是从 <span class="math inline">\(x\)</span> 到 <span class="math inline">\(y\)</span> 的单位流且在任何 <span class="math inline">\(z\notin e\)</span> 处散度为 0。又由于投影分量属于
<span class="math inline">\(\bigstar\)</span>
所以还满足欧姆定律，从而必然是电流 <span class="math inline">\(i^e\)</span>。<span class="math inline">\(\blacksquare\)</span></p>
<div id="iee" class="statement proposition plain">
<p><span class="statement-heading"><span class="statement-label">命题
2.4</span>.</span><span class="statement-spah"> </span>设 <span class="math inline">\(e,\,e'\)</span> 是两条边，则 <span class="math display">\[i^e(e')=c(e')(i^e,
i^{e'})_E.\]</span></p>
</div>
<p><strong>证明</strong>：记 <span class="math inline">\(P_\bigstar\)</span> 为从 <span class="math inline">\(\ell^2_{-}(E)\)</span> 到 <span class="math inline">\(\bigstar\)</span> 的投影算子，则 <span class="math inline">\(P_\bigstar\)</span> 是自共轭算子以及 <span class="math inline">\(P_\bigstar^2=P_\bigstar\)</span>，从而 <span class="math display">\[(i^e,
i^{e'})_E=(P_\bigstar\chi^e,P_\bigstar\chi^{e'})_E=(P_\bigstar\chi^e,\chi^{e'})_E=(i^e,\chi^{e'})_E=r(e')i^e(e').\]</span>
即得结论。<span class="math inline">\(\blacksquare\)</span></p>
<div id="def-transfer-current" class="statement definition plain">
<p><span class="statement-heading"><span class="statement-label">定义
2.5</span>.</span><span class="statement-spah"> </span>记 <span class="math inline">\(Y(e,e')=i^e(e')\)</span>，则矩阵 <span class="math inline">\(\big(Y(e,e')\big)_{e,e'\in E}\)</span>
叫做转移电流矩阵。<span class="math inline">\(Y(e,e')\)</span>
满足互反律 <span class="math display">\[Y(e,e')r(e')=Y(e',e)r(e)=(i^e,i^{e'})_E.\]</span></p>
</div>
<div id="unit-flow" class="statement corollary plain">
<p><span class="statement-heading"><span class="statement-label">推论
2.6</span>.</span><span class="statement-spah"> </span>设 <span class="math inline">\(x,\,y\)</span> 是两个顶点，在所有从 <span class="math inline">\(x\)</span> 到 <span class="math inline">\(y\)</span>
的单位流中，电流的能量最小。并且电流的能量等于 <span class="math inline">\(x,\,y\)</span> 之间的等效电阻。</p>
</div>
<p><strong>证明</strong>：设 <span class="math inline">\(f,g\)</span>
是任何这样的两个单位流，则 <span class="math inline">\(f-g\)</span>
处处净流量为 0，即 <span class="math inline">\(f-g\in\lozenge\)</span>，从而 <span class="math inline">\(P_\bigstar f = P_\bigstar g = i\)</span>，所以电流
<span class="math inline">\(i\)</span> 是唯一确定的。注意到 <span class="math inline">\((i, f-i)_E=0\)</span>，所以 <span class="math display">\[\mathcal{E}(f)=(f,\,f)_{E} = (i,i)_{E} +
(f-i,f-i)_{E}\geq (i,i)_{E}=\mathcal{E}(i).\]</span>
于是我们证明了电流能量的最小性。为了证明它等于 <span class="math inline">\(x,\, y\)</span> 之间的等效电阻，可以利用 <span class="math display">\[(i,i)_E = (i, \chi^e)_E = r(x,y)i(x,y)\chi^e(x,y)
= r(x,y)i(x,y)= U(x)-U(y).\]</span> 其中 <span class="math inline">\(U(x)-U(y)\)</span> 是 <span class="math inline">\(x,\,y\)</span> 之间的电势差，而流入网络的总电流是
1，所以这个电势差等于网络的等效电阻。</p>
<p>由此结论可以进一步得出 <strong>Rayleigh
单调原理</strong>：如果把一个网络的电阻调低的话，则原来的单位电流会变成一个能量更小的单位流，而此单位流的能量又大于等于新网络对应的单位电流的能量，所以新网络的等效电阻相比之前是下降的。</p>
<h1 id="概率解释">3 概率解释</h1>
<p>在这一节中，我们会给出电势、电流对应的概率解释。假设 <span class="math inline">\(a\)</span> 是一个顶点，<span class="math inline">\(Z\)</span> 是一个顶点集合且 <span class="math inline">\(a\notin Z\)</span>。</p>
<ul>
<li><p>我们考虑从一点 <span class="math inline">\(x\)</span>
出发，转移概率为 <span class="math inline">\(P(x,y)=c(x,y)/c(x)\)</span>
的随机游动 <span class="math inline">\(\{X_t,t\geq0\}\)</span>，其中
<span class="math inline">\(X_0=x\)</span>。这个随机游动是可逆的 Markov
链，以 <span class="math inline">\(\{c(x),x\in V\}\)</span>
为平稳测度：<span class="math inline">\(c(x)P(x,y)=c(y)P(y,x)\)</span>。</p></li>
<li><p>我们同时考虑在 <span class="math inline">\(a\)</span>
点接上电源正极，<strong>并将 <span class="math inline">\(Z\)</span>
接地</strong>，则电流从 <span class="math inline">\(a\)</span> 流入并从
<span class="math inline">\(Z\)</span>
流出。我们将建立随机游动和这一电网络之间的联系。</p></li>
</ul>
<h2 id="电压的概率解释-第一种">电压的概率解释 （第一种）</h2>
<p>电压有一个很简单的解释，它是直线上随机游动中赌徒获胜/破产概率的类比。</p>
<p>考虑从 <span class="math inline">\(x\)</span> 出发的随机游动，设
<span class="math inline">\(\tau_a\)</span> 是这一随机游动首次到达 <span class="math inline">\(a\)</span> 点的时间 （类比赌徒获胜），<span class="math inline">\(\tau_Z\)</span> 是这一随机游动首次到达集合 <span class="math inline">\(Z\)</span> 的时间 （类比赌徒输光），并考虑概率
<span class="math display">\[h(x) =
\mathbb{P}_x(\tau_a&lt;\tau_Z).\]</span> 其中我们规定 <span class="math inline">\(h(a)=1, h(Z)=0\)</span>，则 <span class="math inline">\(h(x)\)</span> 在任何 <span class="math inline">\(x\notin \{a\}\cup Z\)</span>
上是<strong>调和</strong>的： <span class="math display">\[h(x) =
\sum_{y\sim x}P(x, y)h(y).\]</span> 此即为全概率公式，下一步到某个 <span class="math inline">\(y\sim x\)</span> 的概率是 <span class="math inline">\(P(x,y)\)</span>，从 <span class="math inline">\(y\)</span> 继续出发获胜的概率是 <span class="math inline">\(h(y)\)</span>，求和即可。</p>
<p>现在假设 <span class="math inline">\(a\)</span> 点加上的电压大小是
1，则其电势 <span class="math inline">\(v(a)=1\)</span>，由于 <span class="math inline">\(Z\)</span> 接地所以 <span class="math inline">\(v(Z)=0\)</span>。我们断言电势函数 <span class="math inline">\(v(x)\)</span> 在任何一点 <span class="math inline">\(x\notin\{a\}\cup Z\)</span> 处也是调和的： <span class="math display">\[v(x) = \sum_{y\sim x}P(x, y)v(y).\]</span>
这是因为设 <span class="math inline">\(v\)</span> 对应的电流是 <span class="math inline">\(i\)</span>，则</p>
<p><span class="math display">\[
\begin{align*}
v(x) - \sum_{y\sim x}P(x, y)v(y)&amp;=
\sum_{y\sim x}P(x, y)(v(x)-v(y))\\&amp;=
\sum_{y\sim x}\frac{c(x,y)}{c(x)}i(x,y)r(x,y)\\&amp;=
\frac{1}{c(x)}\sum_{y\sim x}i(x,y)\\&amp;=
0.
\end{align*}
\]</span></p>
<p>其中最后一个等号是根据基尔霍夫定律对任何中间节点 <span class="math inline">\(x\)</span> 有 <span class="math inline">\((\mathrm{div}\,i)(x)=0\)</span>。</p>
<p>现在获胜概率 <span class="math inline">\(\mathbb{P}_x(\tau_a&lt;\tau_Z)\)</span> 和电势函数
<span class="math inline">\(v(x)\)</span> 在 <span class="math inline">\(\{a\}\cup Z\)</span> 上有相同的边界条件，在 <span class="math inline">\((\{a\}\cup Z)^c\)</span>
上都是调和的，则它俩必然是同一个函数！（提示：考虑两个函数之差并利用有限图上的调和函数必然在边界上取得最大最小值）
于是我们得到</p>
<blockquote>
<p><strong>电压的概率解释</strong>：在 <span class="math inline">\(a\)</span> 加上单位 1 的电压，将 <span class="math inline">\(Z\)</span> 接地，则任一顶点 <span class="math inline">\(x\)</span> 处的电势等于从 <span class="math inline">\(x\)</span> 出发的随机游动在到达 <span class="math inline">\(Z\)</span> 之前先到达 <span class="math inline">\(a\)</span> 的概率：<span class="math inline">\(v(x)=\mathbb{P}_x(\tau_a&lt;\tau_Z)\)</span>。</p>
</blockquote>
<p>如果 <span class="math inline">\(a\)</span>
处不是单位电压的话，则结论中的 <span class="math inline">\(v(x)\)</span>
应替换为 <span class="math inline">\(v(x)/v(a)\)</span>。</p>
<h2 id="电阻电压-第二种电流的概率解释">电阻、电压
（第二种）、电流的概率解释</h2>
<p>在这一节中，我们将使用 Green
函数给出电流的概率解释，以及电压的第二种解释。</p>
<p>Green
函数是图上拉普拉斯算子的“基本解”，用它可以表示出一般的带边界条件的调和函数。</p>
<p>记 <span class="math inline">\(\mathbb{P}(a\to Z)=\mathbb{P}_a(\tau_Z
&lt; \tau_a^+)\)</span> 为从 <span class="math inline">\(a\)</span>
出发的随机游动在返回 <span class="math inline">\(a\)</span> 之前先到达
<span class="math inline">\(Z\)</span> 的概率。此概率称作从 <span class="math inline">\(a\)</span> 到 <span class="math inline">\(Z\)</span> 的<strong>逃逸概率</strong>。</p>
<p>仍然在 <span class="math inline">\(a\)</span> 处加上电压，<span class="math inline">\(Z\)</span> 接地，考虑此网络的电势 <span class="math inline">\(v\)</span> 和电流 <span class="math inline">\(i\)</span>。</p>
<div class="statement lemma plain">
<p><span class="statement-heading"><span class="statement-label">引理
3.1</span>.</span><span class="statement-spah"> </span><span class="math display">\[\frac{v(a)}{\| i\|} =
\frac{1}{c(a)\mathbb{P}(a\to Z)}.\]</span></p>
</div>
<p>注意 <span class="math inline">\(v(a)/\|i\|\)</span>
正是网络的等效电阻。</p>
<p><strong>证明</strong>：</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{P}(a\to Z) &amp;= \sum_{x\sim a}P(a, x)\mathbb{P}_x(\tau_Z &lt;
\tau_a)\\&amp;=
\sum_{x\sim
a}\frac{c(a,x)}{c(a)}\left(1-\frac{v(x)}{v(a)}\right)\\&amp;=
\sum_{x\sim a}\frac{c(a,x)}{c(a)}\frac{v(a)-v(x)}{v(a)}\\&amp;=
\sum_{x\sim a}\frac{i(a,x)}{c(a)v(a)}\\&amp;=
\frac{\|i\|}{c(a)v(a)}.
\end{align*}
\]</span></p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<p>对任何边 <span class="math inline">\(x\sim y\)</span>，定义随机变量
<span class="math inline">\(N_{x\to y}^Z\)</span> 为从 <span class="math inline">\(a\)</span> 出发的随机游动在访问 <span class="math inline">\(Z\)</span> 之前从 <span class="math inline">\(x\)</span> 走到 <span class="math inline">\(y\)</span> 的次数，则我们有如下定理：</p>
<div id="current-interp" class="statement theorem plain">
<p><span class="statement-heading"><span class="statement-label">定理
3.2</span>.</span><span class="statement-spah">
</span>设电流是单位电流：<span class="math inline">\(\|i\|=1\)</span>，此时的电势函数为 <span class="math inline">\(v\)</span>，则</p>
<ol type="1">
<li><span class="math inline">\(v(x) = \mathcal{G}_Z(a, x)/
c(x)\)</span>。</li>
<li><span class="math inline">\(i(x,y)=\mathbb{E}_a\left[N_{x\to y}^Z -
N_{y\to x}^Z\right]\)</span>。</li>
</ol>
<p>其中 <span class="math inline">\(\mathcal{G}_Z(a, x)\)</span>
是随机游动的 Green 函数，其定义为从 <span class="math inline">\(a\)</span> 出发的随机游动在到达 <span class="math inline">\(Z\)</span> 之前访问 <span class="math inline">\(x\)</span> 的期望次数： <span class="math display">\[\mathcal{G}_Z(a, x) = \sum_{0\leq
k&lt;\tau_Z}\mathbb{1}_{\{X_k=x\}}.\]</span></p>
</div>
<p><strong>证明</strong>：</p>
<ol type="1">
<li><p>首先边界条件给出了 <span class="math inline">\(\mathcal{G}_Z(a,
Z)=0\)</span>。此外 <span class="math inline">\(\mathcal{G}_Z(a,
a)\)</span> 是一个每次试验成功概率为 <span class="math inline">\(\mathbb{P}(a\to Z)\)</span>
的几何分布的随机变量的期望，故 <span class="math display">\[\mathcal{G}_Z(a, a)=\frac{1}{\mathbb{P}(a\to
Z)},\]</span> 再由上面的引理，有 <span class="math display">\[\frac{\mathcal{G}_Z(a,
a)}{c(a)}=\frac{1}{c(a)\mathbb{P}(a\to Z)}=v(a).\]</span> 所以 <span class="math inline">\(\mathcal{G}_Z(a, x)/c(x)\)</span>
在边界上与电势函数是一致的，只要再证明在任意中间节点 <span class="math inline">\(x\)</span> 的调和性质。注意随机游动必然是从与
<span class="math inline">\(x\)</span> 相邻的顶点走过去访问 <span class="math inline">\(x\)</span>，所以 <span class="math display">\[\frac{\mathcal{G}_Z(a,
x)}{c(x)}=\frac{1}{c(x)}\sum_{y\sim x}\mathbb{E}_a[N_{y\to
x}^Z].\]</span> 另一方面</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{E}_a[N_{y\to x}^Z]&amp;=
\mathbb{E}_a\left[\sum_{0\leq t&lt;\tau_Z}\mathbb{1}_{\{ X_t=y,X_{t+1}=x
\}}\right]\\&amp;=
\sum_{0\leq t&lt;\tau_Z}\mathbb{P}\left[X_t=y,X_{t+1}=x\right]\\&amp;=
\sum_{0\leq t&lt;\tau_Z}\mathbb{P}(X_t=y)P(y,x)\\&amp;=
P(y,x)\mathbb{E}_a\left[\sum_{0\leq t&lt;\tau_Z}\mathbb{1}_{\{ X_t=y
\}}\right]\\&amp;=
P(y,x)\mathcal{G}_Z(a,y).
\end{align*}
\label{eq:cross}
\]</span></p>
<p>所以代入求和后有</p>
<p><span class="math display">\[
\frac{1}{c(x)}\sum_{y\sim x}\mathbb{E}_a[N_{y\to
x}^Z]=\frac{1}{c(x)}\sum_{y\sim x}P(y,x)\mathcal{G}_Z(a,y)=\sum_{y\sim
x}P(x,y)\frac{\mathcal{G}_Z(a,y)}{c(y)}.
\]</span></p>
<p>其中我们使用了 Markov 链的可逆性：<span class="math inline">\(c(x)P(x,y)=c(y)P(y,x)\)</span>。这就证明了 <span class="math inline">\(\mathcal{G}_Z(a, x)/c(x)\)</span>
在中间节点的调和性，从而它就是电势函数，这证明了 1。</p></li>
<li><p>直接验证即可： <span class="math display">\[\begin{align*}\mathbb{E}_a\left[N_{x\to y}^Z -
N_{y\to
x}^Z\right]&amp;=P(x,y)\mathcal{G}_Z(a,x)-P(y,x)\mathcal{G}_Z(a,y)\\&amp;=P(x,y)c(x)v(x)
-
P(y,x)c(y)v(y)\\&amp;=c(x,y)(v(x)-v(y))\\&amp;=i(x,y).\end{align*}\]</span></p></li>
</ol>
<p><span class="math inline">\(\blacksquare\)</span></p>
<h1 id="wilson-生成树算法">4 Wilson 生成树算法</h1>
<p>这一节的目的是介绍怎样将一条给定边 <span class="math inline">\(e\)</span> 属于一个随机生成树 <span class="math inline">\(T\)</span> 的概率 <span class="math inline">\(\mathbb{P}(e\in T)\)</span>
表示为随机游动中的概率。这里的关键是 Wilson
算法，它通过<strong>擦圈的随机游动</strong>按照一定的权重分布在全体生成树中随机地取样，这里一个生成树
<span class="math inline">\(T\)</span> 的权重 <span class="math inline">\(w(T)=\prod_{e\in T}c(e)\)</span>，任一生成树 <span class="math inline">\(T_0\)</span> 被选中的概率为 <span class="math inline">\(w(T_0)/\sum_{T}w(T)\)</span>。</p>
<p>在下文中“随机生成树”一词均指服从上述权重分布的随机生成树。</p>
<p>Wilson 算法的步骤如下：</p>
<ol type="1">
<li>任取一个根节点 <span class="math inline">\(r\)</span>，维护一个树
<span class="math inline">\(T\)</span>，初始时 <span class="math inline">\(T=\{r\}\)</span>。</li>
<li>任取一个顶点 <span class="math inline">\(v\notin T\)</span>，从
<span class="math inline">\(v\)</span> 出发作 <span class="math inline">\(G\)</span> 上的擦圈随机游动，直到随机游动撞到
<span class="math inline">\(T\)</span> 为止，然后将随机游动的路径 <span class="math inline">\(p\)</span> 加入 <span class="math inline">\(T\)</span> 中：<span class="math inline">\(T=T\cup
p\)</span>。</li>
<li>重复步骤 2 直到 <span class="math inline">\(T\)</span>
是一个生成树为止。</li>
</ol>
<blockquote>
<p>下面这个动画演示了 Wilson
算法的过程，你可以随时单击画布来重启动画。</p>
</blockquote>
<script type="text/javascript" src="/code/wilson_small.js"></script>
<div data-align="center">
<canvas id="wilson" width="572" height="292">
</canvas>
</div>
<p>Wilson 算法正确性的证明比较繁琐，这里不再赘述，你可以参考我 <a href="/wilson-uniform-spanning-tree-algorithm">之前的一篇文章</a>。初次遇到这个算法的话可以先跳过证明，只记住结论。这个算法的重点就是初始时的根节点是可以任意选取的，每次进行擦圈的随机游动时选择的出发顶点也可以是任意的，这都不影响得到的生成树
<span class="math inline">\(T\)</span> 的分布。</p>
<div id="lerw" class="statement theorem plain">
<p><span class="statement-heading"><span class="statement-label">定理
4.1</span>.</span><span class="statement-spah"> </span>设 <span class="math inline">\(\mathcal{N}=(G,c)\)</span> 是一个网络，给定边
<span class="math inline">\(e=(x,y)\in E\)</span>，在 <span class="math inline">\(x\)</span> 处加上电源并将 <span class="math inline">\(y\)</span> 接地，使得流入网络的电流是单位流 <span class="math inline">\(i^e\)</span>。则对 <span class="math inline">\(G\)</span> 的随机生成树 <span class="math inline">\(T\)</span>，<span class="math inline">\(e\)</span>
属于 <span class="math inline">\(T\)</span> 的概率即为此时 <span class="math inline">\(e\)</span> 中的电流量 <span class="math inline">\(i^e(e)\)</span>，它也等于从 <span class="math inline">\(x\)</span> 出发的随机游动首次访问 <span class="math inline">\(y\)</span> 是从边 <span class="math inline">\(e\)</span> 走过去的这一事件的概率： <span class="math display">\[\mathbb{P}(e \in T) = i^e(e) =
\mathbb{P}_x\left[\text{the first visit to $y$ is across
$(x,y)$}\right].\]</span></p>
</div>
<blockquote>
<p>一个非常出人意料的结论，它把生成树、随机游动和电网络统一在一起。</p>
</blockquote>
<p><strong>证明</strong>：在 Wilson 算法中将初始根节点选为 <span class="math inline">\(y\)</span>，并将第一次出发作擦圈随机游动的顶点选为
<span class="math inline">\(x\)</span>，则此随机游动首次到达 <span class="math inline">\(y\)</span> 有两种可能：</p>
<ol type="1">
<li>是从边 <span class="math inline">\((x,y)\)</span> 走到 <span class="math inline">\(y\)</span> 的，此随机游动的路径属于 <span class="math inline">\(T\)</span>，自然也有 <span class="math inline">\(e\in T\)</span>。</li>
<li>是从其它边走到 <span class="math inline">\(y\)</span>
的，则此随机游动的路径属于 <span class="math inline">\(T\)</span>
但不可能有 <span class="math inline">\(e\in T\)</span>，否则 <span class="math inline">\(T\)</span> 中会出现回路。</li>
</ol>
<p>于是我们证明了 <span class="math inline">\(e\in T\)</span> 当且仅当从
<span class="math inline">\(x\)</span> 出发的随机游动首次到达 <span class="math inline">\(y\)</span> 是从边 <span class="math inline">\(e\)</span> 走过去的。</p>
<p>另一方面在 <a href="#current-interp" title="定理 3.2">定理 3.2</a>
中取 <span class="math inline">\(Z=\{y\}\)</span> 有</p>
<p><span class="math display">\[
i^e(x,y)=\mathbb{E}_x\left[N^{\{y\}}_{x\to y} - N^{\{y\}}_{y\to
x}\right].
\]</span></p>
<p>注意到从 <span class="math inline">\(x\)</span>
出发的随机游动不可能在到达 <span class="math inline">\(y\)</span> 之前从
<span class="math inline">\(y\)</span> 走到 <span class="math inline">\(x\)</span>，所以 <span class="math inline">\(N^{\{y\}}_{y\to x}=0\)</span>。同时它在到达 <span class="math inline">\(y\)</span> 之前从 <span class="math inline">\(x\)</span> 走到 <span class="math inline">\(y\)</span> 的次数只能是 0 或者 1，所以 <span class="math inline">\(N^{\{y\}}_{x\to y}\in\{0,1\}\)</span>，从而 <span class="math display">\[\mathbb{E}_xN^{\{y\}}_{x\to
y}=\mathbb{P}_x(N^{\{y\}}_{x\to y}=1)=\mathbb{P}_x\left[\text{the first
visit to $y$ is across $(x,y)$}\right].\]</span> 这就完成了证明。</p>
<h1 id="图的收缩">5 图的收缩</h1>
<p>设 <span class="math inline">\(\mathcal{N}=(G,c)\)</span>
是一个网络，<span class="math inline">\(F\subset E\)</span> 是边的子集且
<span class="math inline">\(F\)</span> 不含回路
（不考虑边的方向），<span class="math inline">\(G\)</span> 关于 <span class="math inline">\(F\)</span> 的图收缩是一个图变换：如果 <span class="math inline">\(G\)</span> 中的两个顶点可以被 <span class="math inline">\(F\)</span>
中的路径连接，则它们在新图中坍缩为同一个顶点；并且 <span class="math inline">\(F\)</span> 中的每条边 <span class="math inline">\(f\)</span> 的两个端点变成新顶点的一条自边
(loop)。这样得到的新图记作 <span class="math inline">\(G/F\)</span>。注意当一条边 <span class="math inline">\(e\notin F\)</span> 如果和 <span class="math inline">\(F\)</span> 中的边构成回路的话，它在 <span class="math inline">\(G/F\)</span> 中也会变成自边。</p>
<p><img style="margin:0px auto;display:block" src="/images/electric-network/graph_reduction.svg" width="400"></p>
<p>在上图中，虽然 <span class="math inline">\(e_1,e_2\)</span> 不属于
<span class="math inline">\(F\)</span>，但是由于它们的两端可以被 <span class="math inline">\(F\)</span> 中的路径连接，所以在收缩后 <span class="math inline">\(e_1,e_2\)</span>
也都变成了自边。我们保留这些自边，于是在收缩变换下 <span class="math inline">\(G\)</span> 的边集 <span class="math inline">\(E\)</span> 与 <span class="math inline">\(G/F\)</span> 的边集 <span class="math inline">\(\widehat{E}\)</span> 一一对应。</p>
<p>严格的说图的收缩是 <span class="math inline">\(G\)</span> 的一个分割
(partition)：在 <span class="math inline">\(G\)</span> 的顶点集 <span class="math inline">\(V\)</span> 上定义等价关系 <span class="math inline">\(\cong\)</span> 为：<span class="math inline">\(x\cong y\)</span> 当且仅当 <span class="math inline">\(x\)</span> 与 <span class="math inline">\(y\)</span> 可以被 <span class="math inline">\(F\)</span> 中的路径连接，则 <span class="math inline">\(G/F\)</span> 的顶点是 <span class="math inline">\(V/\cong\)</span> 下的等价类，<span class="math inline">\(G\)</span> 中的边 <span class="math inline">\(e=(x,y)\)</span> 在 <span class="math inline">\(G/F\)</span> 中的边变为 <span class="math inline">\(e=([x],[y])\)</span>，其中 <span class="math inline">\([x]\)</span> 是 <span class="math inline">\(x\)</span> 所在的等价类。</p>
<p>我们想知道图 <span class="math inline">\(G\)</span> 中的电流函数
<span class="math inline">\(i^e\)</span> 和图 <span class="math inline">\(G/F\)</span> 中的电流函数 <span class="math inline">\(\widehat{i^e}\)</span> 之间的关系。这里需要假定
<span class="math inline">\(e\)</span> 在 <span class="math inline">\(G/F\)</span> 中没有变成一条自边。收缩 <span class="math inline">\(F\)</span> 以后 <span class="math inline">\(i^e\)</span> 仍然是 <span class="math inline">\(G/F\)</span> 中从 <span class="math inline">\(e\)</span>
的一端到另一端的单位流，但一般不再是电流。根据 <a href="#unit-flow" title="推论 2.6">推论 2.6</a>，<span class="math inline">\(\widehat{i^e}\)</span> 应该是 <span class="math inline">\(i^e\)</span> 在 <span class="math inline">\(G/F\)</span> 的星空间 <span class="math inline">\(\widehat{\bigstar}\)</span>
上的投影分量，所以我们需要找出这个投影映射。</p>
<p>下面的论证读起来会有点让人恼火，但它的直观含义并不难理解：<span class="math inline">\(i^e\)</span> 不是 <span class="math inline">\(G/F\)</span> 中的电流的原因是，<span class="math inline">\(i^e\)</span> 可能在某些 <span class="math inline">\(F\)</span> 中的边上的值不是 0，而这些边在 <span class="math inline">\(G/F\)</span> 中变成了自边，自边的电流应该是
0。所以为了从 <span class="math inline">\(i^e\)</span> 得到 <span class="math inline">\(\widehat{i^e}\)</span>，我们可以在某些 <span class="math inline">\(F\)</span>
中的边两端加上电压，使得它们产生的电流可以和 <span class="math inline">\(i^e\)</span> 在 <span class="math inline">\(F\)</span> 上的电流抵消，这样处理后的 <span class="math inline">\(i^e\)</span> 转到 <span class="math inline">\(G/F\)</span> 中就是我们想要的电流了。即我们给
<span class="math inline">\(i^e\)</span> 减去 <span class="math inline">\(Z=\text{span}\{i^f,f\in F\}\)</span>
中的一个电流，这相当于取 <span class="math inline">\(i^e\)</span> 在
<span class="math inline">\(Z\)</span> 的正交补 <span class="math inline">\(Z^\bot\)</span> 上的投影分量。由于 <span class="math inline">\(F\)</span> 中的边在 <span class="math inline">\(G/F\)</span> 中变成了自边，所以每个 <span class="math inline">\(i^f\)</span>
都是从单个顶点流入流出，不会影响任何顶点处的守恒性。</p>
<p>我们下面就来论证上面这个直观分析是正确的。论证细节比较琐碎，如果理解了想法的话跳过去也不影响阅读。</p>
<p>记 <span class="math inline">\(\chi^F=\{\chi^f,f\in
F\}\)</span>，<span class="math inline">\(Z=\mathrm{span}\{i^f,f\in
F\}=P_\bigstar\chi^F\)</span>，则 <span class="math inline">\(Z\subset\bigstar\)</span>。我们来证明对 <span class="math inline">\(G/F\)</span> 的环空间 <span class="math inline">\(\widehat{\lozenge}\)</span> 有 <span class="math display">\[\widehat{\lozenge} = \lozenge + \chi^F.\]</span>
首先若 <span class="math inline">\(C\)</span> 是 <span class="math inline">\(G\)</span> 中的环： <span class="math display">\[v_1\xrightarrow{e_1}v_2\xrightarrow{e_2}\cdots\xrightarrow{e_{k-1}}v_k\xrightarrow{e_k}v_1.
\]</span></p>
<p>那自然有</p>
<p><span class="math display">\[
[v_1]\xrightarrow{e_1}[v_2]\xrightarrow{e_2}\cdots\xrightarrow{e_{k-1}}[v_k]\xrightarrow{e_k}[v_1].
\]</span></p>
<p>从而 <span class="math inline">\(C\)</span> 也是 <span class="math inline">\(G/F\)</span> 中的环，其对应的 <span class="math inline">\(f^C\in\widehat{\lozenge}\)</span>。此外 <span class="math inline">\(F\)</span> 中的边在 <span class="math inline">\(G/F\)</span> 变成自边，所以 <span class="math inline">\(\chi^F\)</span> 也属于 <span class="math inline">\(\widehat{\lozenge}\)</span>。即 <span class="math inline">\(\widehat{\lozenge} \supseteq \lozenge +
\chi^F\)</span>。</p>
<p>反之对 <span class="math inline">\(G/F\)</span> 中的一个环 <span class="math inline">\(C_{G/F}\)</span>，我们显然可以通过适当插入 <span class="math inline">\(F\)</span> 中的边来得到 <span class="math inline">\(G\)</span> 中的一个环 <span class="math inline">\(C\)</span> （把每个等价类顶点展开为由 <span class="math inline">\(F\)</span> 中的边组成的路径即可），对应的 <span class="math inline">\(f^C\)</span> 是 <span class="math inline">\(f^{C_{G/F}}\)</span> 加上一些 <span class="math inline">\(\chi^f\)</span> 的和，所以 <span class="math inline">\(\widehat{\lozenge} \subseteq \lozenge +
\chi^F\)</span>，从而反向的包含关系也成立，二者确实相等。</p>
<p>现在我们有 <span class="math display">\[\ell^2_{-}(E) =
\bigstar\oplus\lozenge=\widehat{\bigstar}\oplus\widehat{\lozenge}.\]</span>
以及 <span class="math inline">\(\widehat{\lozenge}\supseteq\lozenge\)</span>，从而
<span class="math inline">\(\widehat{\bigstar}\subseteq\bigstar\)</span>。所以我们进一步有
<span class="math display">\[\widehat{\lozenge}=(\bigstar\cap\widehat{\lozenge})\oplus\lozenge.\]</span></p>
<blockquote>
<p>上式右边显然是个直和，且包含在左边中。为了看出左边也包含在右边中，设
<span class="math inline">\(x\in\widehat{\lozenge}=y+z\)</span>，其中
<span class="math inline">\(y\in\bigstar,z\in\lozenge\)</span>，显然
<span class="math inline">\(y=x-z\in\bigstar\cap\widehat{\lozenge}\)</span>。</p>
</blockquote>
<p>从而 <span class="math display">\[\ell^2_{-}(E)=\widehat{\bigstar}\oplus\widehat{\lozenge}=\widehat{\bigstar}\oplus(\bigstar\cap\widehat{\lozenge})\oplus\lozenge.\]</span>
我们来证明中间的 <span class="math inline">\(\bigstar\cap\widehat{\lozenge}\)</span> 等于 <span class="math inline">\(Z=P_\bigstar\chi^F\)</span>。为此只要注意到 <span class="math display">\[\bigstar\cap\widehat{\lozenge} =
P_{\bigstar}\widehat{\lozenge}=P_{\bigstar}\lozenge +
P_{\bigstar}\chi^F=Z.\]</span> 于是 <span class="math display">\[\ell^2_{-}(E) =\widehat{\bigstar}\oplus
Z\oplus\lozenge.\]</span> 所以对 <span class="math inline">\(G\)</span>
的一条边 <span class="math inline">\(e\)</span>，如果它在 <span class="math inline">\(G/F\)</span> 中没有变成一条自边的话，则电流 <span class="math inline">\(i^e\)</span> 和 <span class="math inline">\(\widehat{i^e}\)</span> 的关系为 <span class="math display">\[\widehat{i^e}=P_{\widehat{\bigstar}}(\chi^e)=P_{Z}^\bot
P_{\bigstar}\chi^F=P_{Z}^\bot i^e.\]</span></p>
<p>至此我们就验证了之前的直观想法。</p>
<p>接下来是一个引理：</p>
<div class="statement lemma plain">
<p><span class="statement-heading"><span class="statement-label">引理
5.1</span>.</span><span class="statement-spah"> </span>当 <span class="math inline">\(F\)</span> 不含回路时，<span class="math inline">\(G\)</span> 的所有包含 <span class="math inline">\(F\)</span> 的生成树 <span class="math inline">\(\{T_G, F\subset T_G\}\)</span> 与 <span class="math inline">\(G/F\)</span> 的所有生成树 <span class="math inline">\(\{T_{G/F}\}\)</span> 一一对应，且 <span class="math display">\[w(T_G)=\prod_{f\in F}c(f)\cdot
w(T_{G/F}).\]</span> 于是对任何 <span class="math inline">\(e\in
E\)</span> 有 <span class="math display">\[\mathbb{P}(e\in T_G \,\big|
\, F\subset T_G) = \mathbb{P}(e\in T_{G/F})=\widehat{i^e}(e).\]</span>
其中 <span class="math inline">\(\widehat{i^e}\)</span> 是 <span class="math inline">\(G/F\)</span> 上的单位流 <span class="math inline">\(\chi^e\)</span> 对应的电流函数。</p>
</div>
<p><strong>证明</strong>：首先不难验证对 <span class="math inline">\(G\)</span> 的任何边集 <span class="math inline">\(C\)</span>，<span class="math inline">\(C\cup
F\)</span> 包含回路当且仅当 <span class="math inline">\(C\)</span> 在
<span class="math inline">\(G/F\)</span> 中包含回路。这是因为如果 <span class="math inline">\(C\cup F\)</span>
包含回路的话，那么对回路的顶点取等价类以后自然得到了一个 <span class="math inline">\(G/F\)</span> 中的回路。反之如果 <span class="math inline">\(C\)</span> 在 <span class="math inline">\(G/F\)</span> 中包含回路的话，那么适当插入 <span class="math inline">\(F\)</span> 中的边以后就可以得到 <span class="math inline">\(G\)</span> 的回路，即 <span class="math inline">\(C\cup F\)</span> 是包含回路的。</p>
<p>于是我们得到 <span class="math inline">\(T_{G/F}\)</span> 是 <span class="math inline">\(G/F\)</span> 的生成树当且仅当 <span class="math inline">\(T_G = T_{G/F}\cup F\)</span> 是 <span class="math inline">\(G\)</span> 的生成树。</p>
<p>由于 <span class="math inline">\(\{T_G,F\subset T_G\}\)</span>
上的分布是条件分布 <span class="math inline">\(\mathbb{P}(\cdot\,\big|\,
F\subset T_G)\)</span>，所以当 <span class="math inline">\(T_G\leftrightarrow T_{G/F}\)</span> 时有 <span class="math inline">\(\mathbb{P}(e\in T_G \,\big| \, F\subset T_G) =
\mathbb{P}(e\in T_{G/F})\)</span>。结合 <a href="#lerw" title="定理 4.1">定理 4.1</a>，引理的成立就是显然的事情了。<span class="math inline">\(\blacksquare\)</span></p>
<p>于是结合 <a href="#iee" title="命题 2.4">命题 2.4</a>
我们有如下定理：</p>
<div id="contraction" class="statement theorem plain">
<p><span class="statement-heading"><span class="statement-label">定理
5.2</span>.</span><span class="statement-spah"> </span>设 <span class="math inline">\(F\subset E\)</span> 不含回路，<span class="math inline">\(e\notin F\)</span> 且与 <span class="math inline">\(F\)</span> 中的边不构成回路，<span class="math inline">\(T_G\)</span> 是 <span class="math inline">\(G\)</span> 的随机生成树，则 <span class="math inline">\(G/F\)</span> 中的单位电流 <span class="math inline">\(\widehat{i^e}\)</span> 是 <span class="math inline">\(G\)</span> 中单位电流 <span class="math inline">\(i^e\)</span> 在子空间 <span class="math inline">\(Z^\bot\)</span> 上的正交投影： <span class="math inline">\(\widehat{i^e}=P_{Z}^\bot i^e\)</span>。于是 <span class="math display">\[\mathbb{P}(e\in T_G \,\big| \, F\subset T_G) =
\widehat{i^e}(e)=c(e)(\widehat{i^e},\widehat{i^e})_{\widehat{E}}=c(e)\big\|P_Z^\bot
i^e\big\|^2.\]</span> 其中 <span class="math inline">\(Z\)</span> 是由
<span class="math inline">\(\{i^f,f\in F\}\)</span> 张成的子空间，<span class="math inline">\(P_Z^\bot\)</span> 是到 <span class="math inline">\(Z^\bot\)</span> 的正交投影。</p>
</div>
<h1 id="转移电流定理">6 转移电流定理</h1>
<div id="------------------" class="statement sta_______ plain unnumbered">
<p><span class="statement-heading"><span class="statement-label">转移电流定理</span>.</span><span class="statement-spah"> </span>设 <span class="math inline">\(\{e_1,\ldots,e_k\}\)</span> 一组边的集合，<span class="math inline">\(T\)</span> 是一个随机生成树，<span class="math inline">\(Y\)</span> 是 <a href="#def-transfer-current" title="如前定义的转移电流矩阵">如前定义的转移电流矩阵</a>，定义 <span class="math inline">\(k\times k\)</span> 矩阵 <span class="math inline">\(Y^{(k)}(i,j)=Y(e_i,e_j)\)</span>，则 <span class="math display">\[\mathbb{P}(e_1,\ldots,e_k\in T) = \det
Y^{(k)}.\]</span></p>
</div>
<div class="statement corollary plain">
<p><span class="statement-heading"><span class="statement-label">推论
6.1</span>.</span><span class="statement-spah"> </span>考虑其中 <span class="math inline">\(r\)</span> 条边 <span class="math inline">\(\{e_1,\ldots,e_r\}\)</span> 不属于 <span class="math inline">\(T\)</span>，另外 <span class="math inline">\(k-r\)</span> 条边 <span class="math inline">\(\{e_{r+1},\ldots,e_k\}\)</span> 属于 <span class="math inline">\(T\)</span> 的概率 <span class="math inline">\(\mathbb{P}(e_1,\ldots,e_r\notin T,
e_{r+1},\ldots,e_k\in T)\)</span>，令 <span class="math inline">\(M^{(r)}\)</span> 是对 <span class="math inline">\(Y^{(k)}\)</span> 的前 <span class="math inline">\(r\)</span> 行取反，给前 <span class="math inline">\(r\)</span> 个对角元加上 1，并保持后 <span class="math inline">\(k-r\)</span> 行不变得到的矩阵：</p>
<p><span class="math display">\[
M^{(r)}(i, j) =\begin{cases}\delta_{ij} -
Y^{(k)}(i, j), &amp; i\leq r\\Y^{(k)}(i,j), &amp;  r+1\leq i\leq
k.\end{cases}
\]</span></p>
<p>则 <span class="math display">\[\mathbb{P}(e_1,\ldots,e_r\notin T,
e_{r+1},\ldots,e_k\in T)=\det M^{(r)}.\]</span></p>
</div>
<p>我们首先说明怎样用转移电流定理得出推论的结论。对排除的边的个数 <span class="math inline">\(r\)</span> 归纳，<span class="math inline">\(r=0\)</span>
的情形就是转移电流定理。设推论对任何小于 <span class="math inline">\(r\)</span> 的情形成立，对 <span class="math inline">\(r\)</span> 的情形，考虑矩阵</p>
<p><span class="math display">\[
P(i, j) = \begin{cases}
  \delta_{ij} - Y^{(k)}(i,j),  &amp; i &lt; r \\
  \delta_{ij}, &amp; i = r  \\
  Y^{(k)}(i,j), &amp; r+1\leq i\leq k.
  \end{cases}
\]</span></p>
<p>则 <span class="math inline">\(M^{(r)},M^{(r-1)},P\)</span> 在所有
<span class="math inline">\(i\ne r\)</span> 的行都相等，但是 <span class="math inline">\(M^{(r)}\)</span> 和 <span class="math inline">\(M^{(r-1)}\)</span> 的第 <span class="math inline">\(r\)</span> 行之和等于 <span class="math inline">\(P\)</span> 第 <span class="math inline">\(r\)</span> 行，于是根据行列式的多重线性性质，
<span class="math display">\[\det M^{(r)}+\det M^{(r-1)}=\det
P.\]</span> 将 <span class="math inline">\(\det P\)</span> 按照 <span class="math inline">\(P\)</span> 的第 <span class="math inline">\(r\)</span> 行展开并对 <span class="math inline">\(\{e_1,\ldots,e_{r-1},e_{r+1},\ldots,e_k\}\)</span>
利用归纳假设，得到</p>
<p><span class="math display">\[
\det P=\mathbb{P}(e_1,\ldots,e_{r-1}\notin T, e_{r+1},\ldots,e_k\in T).
\]</span></p>
<p>又对 <span class="math inline">\(\{e_1,\ldots,e_{r-1},e_r,\ldots,e_k\}\)</span>
利用归纳假设得到</p>
<p><span class="math display">\[
\det M^{(r-1)} = \mathbb{P}(e_1,\ldots,e_{r-1}\notin T,
e_{r},\ldots,e_k\in T)
\]</span></p>
<p>相减即得结论。</p>
<p>回到转移电流定理的证明。分两种情形：</p>
<ol type="1">
<li><p>如果 <span class="math inline">\(\{e_1,\ldots,e_k\}\)</span>
中包含某个回路 <span class="math inline">\(C\)</span>
的话，我们可以适当重排它们并选取 <span class="math inline">\(a_i\in\{+1,-1,0\}\)</span> 使得 <span class="math inline">\(\sum_{i=1}^k
a_i\chi^{e_i}=f_C\in\lozenge\)</span>，这里对不属于 <span class="math inline">\(C\)</span> 的 <span class="math inline">\(e_i\)</span> 取 <span class="math inline">\(a_i=0\)</span>，对属于 <span class="math inline">\(C\)</span> 的 <span class="math inline">\(e_i\)</span> 通过选择 <span class="math inline">\(a_i=\pm1\)</span>
使得它们的方向为依次首尾相接。根据基尔霍夫电压定律，对任何电流 <span class="math inline">\(i^{e_m}\,(1\leq m\leq
k)\)</span>，其绕回路一圈电势的改变为 0，所以 <span class="math display">\[ 0 =
\sum_{i=1}^kr(e_i)i^{e_m}(a_ie_i)=\sum_{i=1}^ka_ir(e_i)i^{e_m}(e_i)=\sum_{i=1}^ka_ir(e_i)Y^{(k)}(e_m,e_i).\]</span>
所以 <span class="math inline">\(Y^{(k)}\)</span> 的列是线性相关的，从而
<span class="math inline">\(\mathbb{P}(e_1,\ldots,e_k\in T)=\det
Y^{(k)}=0\)</span>，结论成立。</p></li>
<li><p>如果 <span class="math inline">\(\{e_1,\ldots,e_k\}\)</span>
中不包含回路的话，对边的个数 <span class="math inline">\(k\)</span>
归纳，<a href="#lerw" title="定理 4.1">定理 4.1</a> 已经给出了 <span class="math inline">\(k=1\)</span> 的情形，所以可以假设 <span class="math inline">\(k&gt;1\)</span> 且结论对所有小于 <span class="math inline">\(k\)</span> 的情形成立。我们注意到 <span class="math inline">\(Y^{(k)}\)</span> “差不多”是一个 <a href="en.wikipedia.org/wiki/Gramian_matrix">Gram 矩阵</a> （见 <a href="#iee" title="命题 2.4">命题 2.4</a>）： <span class="math display">\[Y^{(k)}(i,j)=Y(e_i,e_j)=c(e_j)(i^{e_i},i^{e_j})_E.\]</span>
即 <span class="math inline">\(Y^{(k)}\)</span> 不过是对每个 <span class="math inline">\(j\)</span>，在 Gram 矩阵 <span class="math inline">\(I^{(k)}=\big((i^{e_i},i^{e_j})\big)_{1\leq i,j\leq
k}\)</span> 的第 <span class="math inline">\(j\)</span> 列上乘以 <span class="math inline">\(c(e_j)\)</span> 得到的，所以 <span class="math display">\[
\det Y^{(k)} = \left(\prod_{i=1}^k c(e_i)\right)\det I^{(k)}.
\]</span> 回忆内积空间中 Gram
矩阵的行列式的几何意义是其张成的平行多面体的体积的平方，它等于 <span class="math inline">\(\{i^{e_1},\ldots,i^{e_{k-1}}\}\)</span> 张成的底面
<span class="math inline">\(Z\)</span> 面积平方乘以 <span class="math inline">\(i^{e_k}\)</span> 到这个底面距离的平方： <span class="math display">\[
\det I^{(k)} = \big\|P_Z^\bot i^{e_k}\big\|^2\det I^{(k-1)}.
\]</span> 其中 <span class="math inline">\(Z=\mathrm{span}\{i^{e_1},\ldots,i^{e_{k-1}}\}\)</span>，<span class="math inline">\(P_Z^\bot\)</span> 是到 <span class="math inline">\(Z\)</span> 的正交补空间 <span class="math inline">\(Z^\bot\)</span> 的投影算子。把 <span class="math inline">\(\prod_{i=1}^kc(e_i)\)</span> 乘回去就得到 <span class="math display">\[
\det Y^{(k)} = c(e_k) \big\|P_Z^\bot i^{e_k}\big\|^2 \det Y^{(k-1)}.
\]</span> 另一方面根据条件概率公式有 <span class="math display">\[
\mathbb{P}(e_1,\ldots,e_k\in T)=
\mathbb{P}(e_k\in T\,\big|\, e_1,\ldots,e_{k-1}\in T)\cdot
\mathbb{P}(e_1,\ldots,e_{k-1}\in T).
\]</span> 而根据 <a href="#contraction" title="定理 5.2">定理 5.2</a>
的结论 <span class="math display">\[
\mathbb{P}(e_k\in T\,\big|\, e_1,\ldots,e_{k-1}\in T) = c(e_k)
\big\|P_Z^\bot i^{e_k}\big\|^2,
\]</span> 从而 <span class="math inline">\(\det Y^{(k)}\)</span> 和
<span class="math inline">\(\mathbb{P}(e_1,\ldots,e_k\in T)\)</span>
有相同的初始条件和递推关系，从而它们相等，转移电流定理得证。</p></li>
</ol>
<h1 id="回答本文开头的问题">7 回答本文开头的问题</h1>
<p>如本文开头所述，解决 <span class="math inline">\(\mathbb{Z}^2\)</span>
中顶点在随机迷宫中度数分布的问题归结为求解 <span class="math inline">\(\mathbb{Z}^2\)</span>
上的转移电流矩阵，即令所有边的电导值均为 1，在一条边 <span class="math inline">\(e=(x,y)\)</span> 两端通入单位电流时，流过另一条边
<span class="math inline">\(e'\)</span>
的电流流量，这等价于求解对应的电势函数 <span class="math inline">\(v\)</span>，也等价于求解 <span class="math inline">\(\mathbb{Z}^2\)</span> 上拉普拉斯算子的解</p>
<p><span class="math display">\[
(\Delta v)(x) = \mathbb{1}_{\{ x=e^- \}} - \mathbb{1}_{\{ x=e^+ \}}.
\]</span></p>
<p>这一步可以通过 Fourier 分析的方法来做，比如 Lyons
等人的教材就是采用的这种方法。但是假定你看过本系列的 <a href="/random-walk-potential-kernel">第一篇文章</a>
的话，我们可以省很多事情，直接用二维随机游动的势核函数 <span class="math inline">\(a(x)\)</span> 来构造电势函数 <span class="math inline">\(v\)</span>。注意到 <span class="math inline">\(a(x)\)</span>
在除去原点之外的任何点是调和的，并且在原点处的值为 0。记</p>
<p><span class="math display">\[
g(u) = \frac{a(u-y)-a(u-x)}{4}.
\]</span></p>
<p>则 <span class="math inline">\(g\)</span> 在除去 <span class="math inline">\(x,y\)</span> 外任何点处是调和的，从而 <span class="math inline">\(i=\nabla g\)</span> 满足欧姆定律、在除 <span class="math inline">\(x,y\)</span> 之外满足基尔霍夫定律，且 <span class="math inline">\(g(x)=a(x-y)/4 = -g(y)\)</span>。又</p>
<p><span class="math display">\[
\begin{align*}
\|i\| &amp;= \sum_{z\sim x}i(x, z)=\sum_{z\sim x}[g(x)-g(z)]\\
&amp;=a(x-y)-\sum_{z\sim x}\frac{a(z-y)-a(z-x)}{4}\\
&amp;=\left(a(x-y)-\sum_{z\sim x}\frac{a(z-y)}{4}\right) +
\sum_{z\in\{\pm(1,0),\pm(0,1)\}}\frac{a(z)}{4}\\
&amp;=1.
\end{align*}
\]</span></p>
<p>其中最后一个等号是因为势核在除去原点之外是调和的，且在原点的四个邻居处值为
1。</p>
<p>于是 <span class="math inline">\(v(u)=g(u)-g(y)\)</span> 即为当 <span class="math inline">\(x\)</span> 通入单位电流，<span class="math inline">\(y\)</span> 接地时 <span class="math inline">\(\mathbb{Z}^2\)</span>
上的电势函数，从而其在任何一边 <span class="math inline">\(e'=(z,w)\)</span> 上的电流为</p>
<p><span class="math display">\[
i(z,w) = g(z) - g(w)=\frac{1}{4}\big[a(z-y)-a(z-x)-a(w-y)+a(w-x)\big].
\]</span></p>
<p>当 <span class="math inline">\(e=(x,y)\)</span> 和 <span class="math inline">\(e'=(z,w)\)</span>
都取自原点相邻的四条边时，根据下图中的势核值代入上式即得本文开头的转移电流矩阵。</p>
<p><img style="margin:0px auto;display:block" src="/images/electric-network/greenfunction.svg" width="350"></p>
<p>举个例子验证一下：取 <span class="math inline">\(e_1=(0,
0)\to(1,0)\)</span>，<span class="math inline">\(e_2=(0,0)\to
(0,1)\)</span>，则 <span class="math inline">\(x=z=(0,0)\)</span>，<span class="math inline">\(y=(1,0)\)</span>，<span class="math inline">\(w=(0,1)\)</span>，于是 <span class="math display">\[i^{e_1}(e_2)=\frac{a(-1,0)-a(0,
0)-a(-1,1)+a(0,1)}{4}=\frac{1}{2}-\frac{1}{\pi}.\]</span> Bingo!</p>
<aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Lyons, Russell, and Peres, Yuval. 2016. Probability on
Trees and Networks. Cambridge Series in Statistical and Probabilistic
Mathematics, vol.&nbsp;42.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Richard Stanley. 2013. Algebraic Combinatorics: Walks,
Trees, Tableaux, and More. Undergraduate Texts in Mathematics.
Springer-Verlag New York.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>



                                                    
  <p class="pink-link-context">
    <a href="/debruijn-rhombus-tiling/" rel="next" title="Escher 风格的非周期密铺">
      上一篇：Escher 风格的非周期密铺
    </a>
  </p>
  

    
      <p class="pink-link-context">
        <a href="/coxeter-groups-and-uniform-tilings/" rel="next" title="Coxeter 群，有限状态机与均匀密铺">
          下一篇：Coxeter 群，有限状态机与均匀密铺
        </a>
      </p>
      
                                            </div>

            </div>
        </div>
    </article>

    


    <section id="comment">
       <script src="https://giscus.app/client.js"
        data-repo="neozhaoliang/neozhaoliang.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxNDQ4MTYxMDc="
        data-category="Announcements"
        data-category-id="DIC_kwDOCKG3684CPDuy"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
       </script>
    </section>


</div>

                    <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large pink">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect green" title="回到顶部"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse yellow darken-1"  data-activates="main-menu" title="菜单"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

            </main>
            


                <noscript>
    <div class="noscript">
        <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // 隐藏禁用javascript（针对微信内置浏览器）的提示
            $('.noscript').hide();

            // 图片缩放效果
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // 给图片加上点击放大效果（materialbox插件）
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // 优化表格的显示
            $('table').each(function() {
                var $table = $(this);
                // 除去多行代码的情况
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // 首页幻灯片
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // 针对gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // 文章目录
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();

            // 目录随屏幕滚动（防止目录过长越过footer）
            var $toc = $('.toc');
            var scrollTargetTop = 0;
            $(window).scroll(function() {
                var $activeLink = $toc.find('a.active.section');
                if ($(window).scrollTop() < 100) {
                    scrollTargetTop = 0;
                } else {
                    if ($activeLink[0]) {
                        scrollTargetTop = $activeLink.offset().top - $toc.offset().top;
                    }
                }
                $toc.css('top', '-' + scrollTargetTop + 'px');
            });

            // 修正文章目录的left-border颜色
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // 针对移动端做的优化：FAB按钮点击一下收回
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // 回到顶部
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // 重置读书页面的Tab标签页的颜色
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('pink lighten-2');

            

            // 搜索功能
            $('.modal-trigger').leanModal({
                // 打开搜索框时自动聚焦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "search.xml";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // 初始化搜索与匹配函数
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>






	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
  		tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
  		tex: 'ams'
		});
	</script>


	

			<script type="text/javascript"
				src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-svg.min.js?config=TeX-AMS_HTML"></script>

			
				

    </body>

    </html>